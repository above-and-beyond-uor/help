<!--

  GNU GENERAL PUBLIC LICENSE
  Version 3, 29 June 2007
  (see LICENSE)

  spreadsheet-flowchart creator

  by Anthony Haffey and Nico Biagi from Scientific Open Solutions

-->
<script src="libraries/jquery-3.3.1.min.js"></script>
<script src="libraries/bootstrap.4.0.min.js"></script>
<script src="libraries/bootbox.4.4.0.min.js"></script>
<script src="libraries/leader-line.min.js"></script>
<script src="libraries/papaparse.4.3.6.min.js"></script>

<link rel="stylesheet" href="libraries/bootstrapCollector.css">



<div id="map"></div>
<script>
function draw_node(this_row, generation){
  console.log("generation");
  console.log(generation);

  /*

  */
  var this_button = $("<button>")
    .addClass("btn")
    .addClass("btn-primary")
    .css("position", "fixed")
    .css("top", "50%")
    .css("left", "50%")
    .css("text-align", "center")
    .css("margin-right", "-50%")
    .css("transform", "translate(-50%, -50%)")
    .html(this_row.text);

  $("body").append(this_button);

  var new_generation = generation + 1;
  var branches = this_row.branches.split(",");
  var no_branches = branches.length;

  var valid_degrees = 360 / generation;

  var branch_degrees = valid_degrees/no_branches;


  // convert to cartesian


  branches.forEach(function(this_location, branch_index){

    var this_degrees = branch_index * branch_degrees;

    var radius = 200;

    var this_new_row = csv_data.filter(function(local_row){
      return local_row.location == this_location;
    })[0];
    if(typeof(this_new_row) !== "undefined"){
      draw_node(this_new_row, new_generation);
    }
  });


}

/*
* valid degrees (out of 360)
  - divide by generation
* direction (?out of 360?)
*/

var csv_data;
$.get("flowdata.csv", function(data){
  csv_data = Papa.parse(data, {
    header: true }
  ).data;

  draw_node(csv_data[0], 1);

});

/*


  csv_data = Papa.parse(data, {
    header: true }
  ).data;
  console.log(csv_data);
  var this_row = [
    csv_data[0], // first row
    0,           // row_no
    null,        // location
    1            // branch_index/branches.length
  ];

})
*/
</script>
